(function($){$.fn.circleSlider=function(methodOrOptions){if(methods[methodOrOptions]){return methods[methodOrOptions].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof methodOrOptions==='object'||!methodOrOptions){return methods.init.apply(this,arguments)}else{$.error('Method '+methodOrOptions+' does not exist on jQuery.circleSlider')}};var methods={value:function(){var el=CircleSlider.get_instance(this),args=Array.prototype.slice.call(arguments,0);if(el){if(args.length){el.setValue(Number(args[0]))}else{return el.getValue()}}},destroy:function(){var el=CircleSlider.get_instance(this);if(el){el.destroy()}},disable:function(){var el=CircleSlider.get_instance(this);if(el){el.disable()}},enable:function(){var el=CircleSlider.get_instance(this);if(el){el.enable()}},start:function(fn){var el=CircleSlider.get_instance(this);if(el&&typeof fn==="function"){el.onStart(fn)}},stop:function(fn){var el=CircleSlider.get_instance(this);if(el&&typeof fn==="function"){el.onStop(fn)}},slide:function(fn){var el=CircleSlider.get_instance(this);if(el&&typeof fn==="function"){el.onSlide(fn)}},change:function(fn){var el=CircleSlider.get_instance(this);if(el&&typeof fn==="function"){el.onChange(fn)}},init:function(o){o=o||{};o.element=this;CircleSlider.create_instance(o)}};function CircleSlider(){var _observers={},_add_observer=function(type,fn){type=type||'all';if(typeof fn==="function"){if(!_observers.hasOwnProperty(type)){_observers[type]=[]}_observers[type].push(fn)}},_clear_observers=function(){_observers={}},_notify_observer=function(type){var args=Array.prototype.slice.call(arguments,1),i,l;type=type||"all";for(i=0,l=_observers[type]?_observers[type].length:0;i<l;i++){_observers[type][i].apply(this,args)}};this.options={};this.view={outer_circle:null,inner_circle:null,control_element:null,value_prefix_element:null,value_element:null,value_suffix_element:null};this.plugin_offset=null;this.inner_offset=null;this.plugin_width=null;this.plugin_height=null;this.center={};this.control_margin={};this.radius={};this.doc=$(document);this.value=0;this.accuracy=0;this.degrees_to_value_transformer=this.integerToValueTransformer;this.value_to_degrees_transformer=this.integerFromValueTransformer;this.enabled=true;this.trigger_event=function(type){_notify_observer.apply(this,arguments)};this.onStart=function(fn){_add_observer("start",fn)};this.onStop=function(fn){_add_observer("stop",fn)};this.onSlide=function(fn){_add_observer("slide",fn)};this.onChange=function(fn){_add_observer("change",fn)}}CircleSlider.prototype.init=function(o){var t;if(!o.element||o.element.length==0){$.error('Target element is not specified.')}o.id=o.element.attr("id");if(!o.id){while(CircleSlider.cached_instances.hasOwnProperty(t=(new Date().getDate().toString()))){}o.id=t}o.element.attr("data-circle-slider-id",o.id);this.options=$.extend({},CircleSlider.default_options,o);this.options.element.append(CircleSlider.build_html(this.options.id));this.degrees_to_value_transformer=this[this.options.format+"ToValueTransformer"]||this["integerToValueTransformer"];this.value_to_degrees_transformer=this[this.options.format+"FromValueTransformer"]||this["integerFromValueTransformer"];this.view.outer_circle=$("#circle-slider-outer-circle-"+this.options.id);this.view.inner_circle=$("#circle-slider-inner-circle-"+this.options.id);this.view.control_element=$("#circle-slider-control-element-"+this.options.id);this.view.value_prefix_element=$("#circle-slider-slider-value-prefix-"+this.options.id);this.view.value_element=$("#circle-slider-slider-value-"+this.options.id);this.view.value_suffix_element=$("#circle-slider-slider-value-suffix-"+this.options.id);this.view.value_prefix_element.html(this.options.prefix);this.view.value_suffix_element.html(this.options.suffix);this.adjustOptions();{this.calculateAccuracy();var d={min:this.options.min,max:this.options.max,step:this.options.step,value:this.options.value,accuracy:this.accuracy},err;err=CircleSlider.validator.validate({'value_1':'range_bound_presence','value_2':'range_max_min'},{'value_1':d,'value_2':d});if(err.length!==0){d.min=this.options.min=CircleSlider.default_options.min;d.max=this.options.max=CircleSlider.default_options.max;CircleSlider.validator.printErrors()}err=CircleSlider.validator.validate({'value':'range_step'},{'value':d});if(err.length!==0){d.step=this.options.step=Math.min(CircleSlider.default_options.step,this.options.max-this.options.min);CircleSlider.validator.printErrors()}err=CircleSlider.validator.validate({'value':'value_in_range'},{'value':d});if(err.length!==0){this.options.value=this.options.min;CircleSlider.validator.printErrors()}}this.calculateAccuracy();this.view.value_element.html(this.options.value);this.setValue(this.options.value);this.bindNativeCallbacks();this.bindCustomCallbacks();this.bindHandlers()};CircleSlider.prototype.adjustOptions=function(){this.options.min=Number(this.options.min);this.options.max=Number(this.options.max);this.options.step=Number(this.options.step);if(this.options.format!="range"){this.options.min=CircleSlider.default_options.min;this.options.max=CircleSlider.default_options.max;this.options.step=CircleSlider.default_options.step}};CircleSlider.prototype.bindCustomCallbacks=function(){var self=this,o=this.options,supported_events=["Start","Stop","Slide","Change"];$.each(supported_events,function(i,e){if(o.hasOwnProperty(e.toLowerCase())){self["on"+e].call(self,o[e.toLowerCase()])}})};CircleSlider.prototype.bindNativeCallbacks=function(){var self=this;this.onStart(function(){self.view.control_element.addClass("state-active")});this.onStop(function(){self.view.control_element.removeClass("state-active");self.setValue(self.value)});this.onSlide(this.valueUpdater);this.onChange(this.valueUpdater)};CircleSlider.prototype.valueUpdater=function(v){this.view.value_element.html(this.value=this.degrees_to_value_transformer.call(this,v))};CircleSlider.prototype.integerToValueTransformer=function(v){return Math.round(v)};CircleSlider.prototype.decimalToValueTransformer=function(v){return Math.round(v*100)/100};CircleSlider.prototype.rangeToValueTransformer=function(v){return Math.round((this.options.min+this.options.step*(Math.round(v/360*((this.options.max-this.options.min)/this.options.step+1))%((this.options.max-this.options.min)/this.options.step+1)))*Math.pow(10,this.accuracy))/Math.pow(10,this.accuracy)};CircleSlider.prototype.abstractFromValueTransformer=function(v){return v};CircleSlider.prototype.integerFromValueTransformer=CircleSlider.prototype.abstractFromValueTransformer;CircleSlider.prototype.decimalFromValueTrasformer=CircleSlider.prototype.abstractFromValueTransformer;CircleSlider.prototype.rangeFromValueTransformer=function(v){return 360*(((v-this.options.min)/this.options.step)%((this.options.max-this.options.min)/this.options.step+1))/((this.options.max-this.options.min)/this.options.step+1)};CircleSlider.prototype.bindHandlers=function(){var self=this;this.view.control_element.on('mousedown',function(e){e.preventDefault();if(!self.enabled)return;self.recalculatePositions();self.trigger_event("start");self.doc.on('mousemove.crlslr',function(e){var y=self.center.y-e.pageY,x=self.center.x-e.pageX,deg=180-Math.atan2(y,x)*CircleSlider.radian_to_degree_coeff;if(deg>=360){deg=deg%360}self.updateControlPosition(deg);self.trigger_event("slide",deg)});self.doc.on('mouseup.crlslr',function(){self.doc.off('.crlslr');self.trigger_event("stop")})})};CircleSlider.prototype.recalculatePositions=function(){this.plugin_width=this.view.outer_circle.width();this.plugin_height=this.view.outer_circle.height();if(this.options.element.is(":visible")){this.plugin_offset=this.view.outer_circle.offset();this.inner_offset=this.view.inner_circle.offset();this.center={x:this.plugin_offset.left+this.plugin_width/2,y:this.plugin_offset.top+this.plugin_height/2};this.control_margin={x:this.inner_offset.left-this.plugin_offset.left,y:this.inner_offset.top-this.plugin_offset.top};this.radius={x:this.plugin_width-this.control_margin.x,y:this.plugin_height-this.control_margin.y}}else{this.inner_offset={left:parseInt(this.view.inner_circle.css("left"),10),top:parseInt(this.view.inner_circle.css("top"),10)};this.control_margin={x:this.inner_offset.left,y:this.inner_offset.top};this.radius={x:this.plugin_width-this.control_margin.x,y:this.plugin_height-this.control_margin.y}}};CircleSlider.prototype.setValue=function(v){var d={min:this.options.min,max:this.options.max,step:this.options.step,accuracy:this.accuracy,value:v},err=CircleSlider.validator.validate({'value':'value_in_range'},{'value':d}),r;if(err.length==0){v=this.value_to_degrees_transformer(v);this.recalculatePositions();this.trigger_event("change",v);this.updateControlPosition(v)}else{for(r in err){if(err.hasOwnProperty(r)){console.error(err[r])}}}};CircleSlider.prototype.updateControlPosition=function(deg){this.view.control_element.css({left:this.radius.x/2*(1+Math.cos(deg*Math.PI/180)),top:this.radius.y/2*(1-Math.sin(deg*Math.PI/180))})};CircleSlider.prototype.getValue=function(){return this.value};CircleSlider.prototype.calculateAccuracy=function(){var s=this.options.step,max_period=5,a=0;while(a<max_period){if(s*Math.pow(10,a)==Math.round(s*Math.pow(10,a))){this.accuracy=a;return}a++}};CircleSlider.prototype.destroy=function(){var o=this.options,id=o?o.id:null,p=o?o.element:null;if(id)delete CircleSlider.cached_instances[id];if(p)p.empty()};CircleSlider.prototype.disable=function(){this.enabled=false;this.view.control_element.addClass("state-disabled")};CircleSlider.prototype.enable=function(){this.enabled=true;this.view.control_element.removeClass("state-disabled")};CircleSlider.default_options={min:0,max:359,step:0.01,value:0,prefix:"",suffix:"",format:"integer"};CircleSlider.build_html=function(id){var h="";h+="<div id='circle-slider-outer-circle-"+id+"' class='ui-circle-slider outer-circle'>"+"<div id='circle-slider-inner-circle-"+id+"' class='ui-circle-slider inner-circle'>"+"<span id='circle-slider-slider-value-prefix-"+id+"' class='ui-circle-slider slider-value-prefix'></span>"+"<span id='circle-slider-slider-value-"+id+"' class='ui-circle-slider slider-value'></span>"+"<span id='circle-slider-slider-value-suffix-"+id+"' class='ui-circle-slider slider-value-suffix'></span>"+"</div>"+"<div id='circle-slider-control-element-"+id+"' class='ui-circle-slider control-element'></div>"+"</div>";return h};CircleSlider.create_instance=function(o){var instance=new CircleSlider();instance.init(o);CircleSlider.cached_instances[instance.options.id]=instance;return instance};CircleSlider.get_instance=function(owner){var instance=null,id;if(owner&&owner.length){id=owner.attr?owner.attr('data-circle-slider-id'):null;if(id){instance=CircleSlider.cached_instances[id]}}return instance};CircleSlider.radian_to_degree_coeff=180/Math.PI;CircleSlider.cached_instances={};CircleSlider.validator={errors:[],types:{range_bound_presence:{validate:function(data){var min=data?data.min:null,max=data?data.max:null;return min!=null&&max!=null},instructions:"Maximum or minimum value in range is not specified."},range_max_min:{validate:function(data){var min=data?data.min:null,max=data?data.max:null;return min!=null&&max!=null&&max>min},instructions:"The upper bound can't be less than the bottom one."},range_step:{validate:function(data){var min=data?data.min:null,max=data?data.max:null,step=data?data.step:null,accuracy=data?data.accuracy:null;this.instructions="Range [ "+min+" ; "+max+" ] can't be covered with the integer number of the specified steps : "+step+".";return min!=null&&max!=null&&step!=null&&((Math.round((max-min)/step*Math.pow(10,accuracy+1))/Math.pow(10,accuracy+1)%1)==0)},instructions:"The specified range can't be covered with the integer number of the specified steps."},value_in_range:{validate:function(data){var min=data?data.min:null,max=data?data.max:null,step=data?data.step:null,value=data?data.value:null,accuracy=data?data.accuracy:null;this.instructions="Value "+value+" doesn't lie in range [ "+min+" ; "+max+" ] , covered by step = "+step+".";return min!=null&&max!=null&&step!=null&&(value>=min)&&(value<=max)&&((Math.round(((value-min)/step)*Math.pow(10,accuracy+1))/Math.pow(10,accuracy+1)%1)==0)},instructions:"The specified value doesn't lie in the initial range."}},validate:function(config,data){var k,type,validator,res;CircleSlider.validator.errors=[];for(k in config){if(config.hasOwnProperty(k)){type=config[k];validator=CircleSlider.validator.types[type];if(!type){continue}if(!validator){$.error("The validator of type "+type+" doesn't exist.")}res=validator.validate(data[k]);if(!res){CircleSlider.validator.errors.push(validator.instructions)}}}return CircleSlider.validator.errors},getErrors:function(){return CircleSlider.validator.errors},printErrors:function(){var i=0,e=this.errors,l=e.length;for(i;i<l;i++){console.error(e[i])}}}}(jQuery));